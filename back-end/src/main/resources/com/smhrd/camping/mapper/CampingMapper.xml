<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.smhrd.camping.mapper.CampingMapper">
  	<!-- <insert id="write" parameterType="com.smhrd.camping.domain.Comunity">
  		insert into TB_STORY(STORY_CATEGORY,STORY_TITLE,STORY_CONTENT,STORY_IMG,USER_EMAIL)
		values('기본',#{story_title},#{story_content},#{story_img},#{story_writer})
  		</insert>
  		
		values(#{story_category},#{story_title},#{story_content},#{story_img},#{user_email})
  	</insert> -->

  	
  	<!-- 게시판 업로드 생성 -->
  	<insert id="write" parameterType="com.smhrd.camping.domain.Comunity">
		insert into TB_STORY(STORY_CATEGORY, STORY_TITLE, STORY_CONTENT, STORY_IMG, USER_EMAIL)
		values( #{story_category}, #{story_title}, #{story_content}, #{story_img}, #{user_email})
	</insert>
	

  	<!-- 상품 카테고리 스텝 -->
  	<select id="CategoryStep" resultType="com.smhrd.camping.domain.Category">
  		select * from TB_CATEGORY
  	</select>
  	
  	
  	<!-- 게시판 게시물 목록 조회 -->
  	<select id="ComunityList" resultType="com.smhrd.camping.domain.Comunity">
  		select * from TB_Story
  	</select>
  	
  	
  	<!-- 상세 게시물 조회 -->
  	<select id="ComunityOne" resultType="com.smhrd.camping.domain.Comunity">
  		select * from TB_Story where story_idx=#{story_idx}
  	</select>
  	

  	
  	<!-- 댓글 작성 -->
  	<insert id="comment" parameterType="com.smhrd.camping.domain.Comment">
  		 <!-- INSERT INTO TB_COMMENT (CMT_IDX, STORY_IDX, CMT_CONTENT, CMT_DT, USER_EMAIL)
        VALUES (NEXTVAL('CMT_IDX_SEQ'), #{story_idx}, #{cmt_content}, SYSDATE, #{user_email}) -->
        insert into tb_comment (cmt_idx, story_idx, cmt_content, cmt_dt, user_email)
        values(1, #{story_idx}, #{cmt_content}, SYSDATE, #{user_email})
  	</insert>
  	
  	
  	<!-- 댓글 목록 -->
  	<select id="CommentList" parameterType="com.smhrd.camping.domain.Comment" resultType="com.smhrd.camping.domain.Comment">
  		<!-- select a.cmt_idx, a.cmt_content, b.user_email from tb_comment a JOIN tb_story b ON a.user_email = b.user_email WHERE a.story_idx = b.story_idx -->
  		select * from tb_comment where story_idx=#{story_idx}
  	</select>
  	
  	
  	<!-- 게시물 검색 -->
	<select id="searchComunity" resultType="com.smhrd.camping.domain.Comunity">
	  		select story_title, story_img from tb_story where story_title like concat('%',#{search},'%')
	  	</select>
  	
  	<!-- 게시판 좋아요 순으로 3개 정렬 -->
  	<select id="LoadCommunityLike" resultType="com.smhrd.camping.domain.Comunity">
  		select * from tb_story where rownum &lt;= 6 order by story_likes desc,story_idx asc
  	</select>
  	
  	<!-- 게시판 조회수 순으로 3개 정렬 -->
  	<select id="LoadCommunityView" resultType="com.smhrd.camping.domain.Comunity">
  		select * from tb_story where rownum &lt;= 6 order by story_views desc,story_idx asc
  	</select>
  	
  
  	<!-- 댓글 삭제 -->
  	<delete id="CommentDelete">
  		delete from tb_comment where cmt_idx=#{cmt_idx} and user_email=#{user_email}
  	</delete>

  </mapper>